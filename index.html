<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8"/>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>BudgetWise - Your Personal Finance Tracker</title>
Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  <style>
Â  Â  /* Variables CSS pour un thÃ¨me facile Ã  gÃ©rer */
Â  Â  :root {
Â  Â  Â  --primary-color: #4F46E5; /* Indigo */
Â  Â  Â  --secondary-color: #6366F1; /* Lighter Indigo */
Â  Â  Â  --income-color: #10B981; /* Emerald Green */
Â  Â  Â  --expense-color: #EF4444; /* Red */
Â  Â  Â  --balance-color: #0EA5E9; /* Sky Blue */
Â  Â  Â  --bg-color: #F8FAFC; /* Light Gray Blue */
Â  Â  Â  --card-bg: #FFFFFF;
Â  Â  Â  --text-color: #1F2937; /* Dark Gray */
Â  Â  Â  --light-text-color: #6B7280; /* Medium Gray */
Â  Â  Â  --border-color: #E5E7EB; /* Light Gray */
Â  Â  Â  --shadow-light: 0 4px 12px rgba(0,0,0,0.06);
Â  Â  Â  --shadow-hover: 0 6px 16px rgba(0,0,0,0.1);
Â  Â  }

Â  Â  /* Reset de base et typographie */
Â  Â  * {
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  }

Â  Â  body {
Â  Â  Â  background: var(--bg-color);
Â  Â  Â  padding: 20px;
Â  Â  Â  color: var(--text-color);
Â  Â  Â  line-height: 1.6;
Â  Â  }

Â  Â  .container {
Â  Â  Â  max-width: 1200px;
Â  Â  Â  margin: 0 auto;
Â  Â  }

Â  Â  /* Styles des cartes gÃ©nÃ©rales */
Â  Â  .card {
Â  Â  Â  background: var(--card-bg);
Â  Â  Â  border-radius: 16px; /* Plus arrondi */
Â  Â  Â  padding: 25px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  box-shadow: var(--shadow-light);
Â  Â  Â  transition: transform 0.2s ease, box-shadow 0.2s ease;
Â  Â  }
Â  Â  .card:hover {
Â  Â  Â  /* transform: translateY(-3px); */
Â  Â  Â  box-shadow: var(--shadow-hover);
Â  Â  }

Â  Â  h1 {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  font-weight: 700;
Â  Â  Â  font-size: 2rem;
Â  Â  Â  color: var(--primary-color);
Â  Â  }

Â  Â  h2 {
Â  Â  Â  font-size: 1.4rem;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  color: var(--text-color);
Â  Â  Â  border-bottom: 1px solid var(--border-color);
Â  Â  Â  padding-bottom: 10px;
Â  Â  }

Â  Â  /* Sommaire des totaux */
Â  Â  .summary {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(3, 1fr);
Â  Â  Â  gap: 15px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  }

Â  Â  .summary div {
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: 600;
Â  Â  Â  box-shadow: var(--shadow-light);
Â  Â  }

Â  Â  .summary div h3 {
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  opacity: 0.9;
Â  Â  Â  font-weight: 500;
Â  Â  Â  margin-bottom: 8px;
Â  Â  }

Â  Â  .summary div span {
Â  Â  Â  font-size: 1.8rem;
Â  Â  Â  display: block;
Â  Â  }

Â  Â  .summary .income-total { background: var(--income-color); }
Â  Â  .summary .expense-total { background: var(--expense-color); }
Â  Â  .summary .balance-total { background: var(--balance-color); }

Â  Â  /* Layout de la grille principale */
Â  Â  .grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }

Â  Â  /* Formulaire */
Â  Â  form {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  gap: 15px;
Â  Â  }

Â  Â  .form-group {
Â  Â  Â  position: relative;
Â  Â  }

Â  Â  .form-group label {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 1px;
Â  Â  Â  height: 1px;
Â  Â  Â  padding: 0;
Â  Â  Â  margin: -1px;
Â  Â  Â  overflow: hidden;
Â  Â  Â  clip: rect(0, 0, 0, 0);
Â  Â  Â  white-space: nowrap;
Â  Â  Â  border: 0;
Â  Â  }

Â  Â  input, select {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 12px 15px;
Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  color: var(--text-color);
Â  Â  Â  background-color: #FDFDFD;
Â  Â  Â  transition: border-color 0.2s ease, box-shadow 0.2s ease;
Â  Â  }

Â  Â  input:focus, select:focus {
Â  Â  Â  border-color: var(--primary-color);
Â  Â  Â  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
Â  Â  Â  outline: none;
Â  Â  }

Â  Â  select {
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  -moz-appearance: none;
Â  Â  Â  appearance: none;
Â  Â  Â  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%234F46E5'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3E%3C/svg%3E");
Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  background-position: right 1rem center;
Â  Â  Â  background-size: 1.5em;
Â  Â  Â  padding-right: 2.5rem;
Â  Â  }

Â  Â  button {
Â  Â  Â  grid-column: 1 / -1;
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  background: var(--primary-color);
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background-color 0.2s ease, transform 0.1s ease;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  button:hover {
Â  Â  Â  background: var(--secondary-color);
Â  Â  Â  transform: translateY(-1px);
Â  Â  }
Â  Â  button:active {
Â  Â  Â  transform: translateY(0);
Â  Â  }

Â  Â  /* Calendrier */
Â  Â  .calendar-nav {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  .calendar-nav button {
Â  Â  Â  width: auto;
Â  Â  Â  padding: 8px 15px;
Â  Â  Â  background: var(--border-color);
Â  Â  Â  color: var(--text-color);
Â  Â  Â  font-size: 1rem;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  transition: background-color 0.2s ease;
Â  Â  }
Â  Â  .calendar-nav button:hover {
Â  Â  Â  background: #D1D5DB;
Â  Â  }

Â  Â  .month-display {
Â  Â  Â  font-size: 1.35rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: var(--primary-color);
Â  Â  }

Â  Â  .calendar-header, .calendar-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(7, 1fr);
Â  Â  Â  gap: 5px;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .calendar-header div {
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: var(--light-text-color);
Â  Â  Â  margin-bottom: 5px;
Â  Â  }

Â  Â  .calendar-day {
Â  Â  Â  aspect-ratio: 1 / 1;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 0.95rem;
Â  Â  Â  cursor: pointer;
Â  Â  Â  position: relative;
Â  Â  Â  padding-top: 5px; /* Espace pour le numÃ©ro */
Â  Â  Â  transition: background-color 0.1s ease, transform 0.1s ease;
Â  Â  }

Â  Â  .calendar-day:hover {
Â  Â  Â  background: #F3F4F6;
Â  Â  Â  transform: translateY(-1px);
Â  Â  }
Â  Â  .calendar-day:active {
Â  Â  Â  transform: translateY(0);
Â  Â  }


Â  Â  .calendar-day.today {
Â  Â  Â  background: var(--primary-color);
Â  Â  Â  color: #fff;
Â  Â  Â  font-weight: 700;
Â  Â  }

Â  Â  .calendar-day.other-month {
Â  Â  Â  color: #D1D5DB;
Â  Â  }

Â  Â  .dots {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 5px;
Â  Â  Â  display: flex;
Â  Â  Â  gap: 3px;
Â  Â  }

Â  Â  .dot {
Â  Â  Â  width: 5px;
Â  Â  Â  height: 5px;
Â  Â  Â  border-radius: 50%;
Â  Â  }

Â  Â  .dot.income { background: var(--income-color); }
Â  Â  .dot.expense { background: var(--expense-color); }

Â  Â  /* Liste des transactions */
Â  Â  .transaction-list {
Â  Â  Â  max-height: 320px; /* LÃ©gÃ¨rement plus haut */
Â  Â  Â  overflow-y: auto;
Â  Â  Â  padding-right: 10px; /* Pour la scrollbar */
Â  Â  }
Â  Â  .transaction-list::-webkit-scrollbar { width: 8px; }
Â  Â  .transaction-list::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
Â  Â  .transaction-list::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
Â  Â  .transaction-list::-webkit-scrollbar-thumb:hover { background: #555; }


Â  Â  .list-item {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  padding: 12px 0;
Â  Â  Â  border-bottom: 1px solid var(--border-color);
Â  Â  Â  transition: background-color 0.1s ease;
Â  Â  }
Â  Â  .list-item:hover {
Â  Â  Â  background-color: #F9FAFB;
Â  Â  }

Â  Â  .list-item:last-child {
Â  Â  Â  border-bottom: none;
Â  Â  }

Â  Â  .item-details strong {
Â  Â  Â  display: block;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  color: var(--text-color);
Â  Â  }
Â  Â  .item-details small {
Â  Â  Â  font-size: 0.8rem;
Â  Â  Â  color: var(--light-text-color);
Â  Â  }

Â  Â  .amount-info {
Â  Â  Â  text-align: right;
Â  Â  }
Â  Â  .amount-info .value {
Â  Â  Â  font-weight: 600;
Â  Â  Â  font-size: 1.1rem;
Â  Â  }
Â  Â  .amount-info small {
Â  Â  Â  display: block;
Â  Â  Â  font-size: 0.75rem;
Â  Â  Â  color: var(--light-text-color);
Â  Â  }

Â  Â  .amount-info .income { color: var(--income-color); }
Â  Â  .amount-info .expense { color: var(--expense-color); }

Â  Â  .delete-btn {
Â  Â  Â  background: var(--expense-color);
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  width: 28px;
Â  Â  Â  height: 28px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-size: 16px;
Â  Â  Â  line-height: 1;
Â  Â  Â  opacity: 0;
Â  Â  Â  transition: opacity 0.2s ease, transform 0.1s ease;
Â  Â  Â  margin-left: 15px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  }
Â  Â  .list-item:hover .delete-btn {
Â  Â  Â  opacity: 1;
Â  Â  }
Â  Â  .delete-btn:hover {
Â  Â  Â  background: #DC2626;
Â  Â  Â  transform: scale(1.05);
Â  Â  }

Â  Â  /* Zone de suppression */
Â  Â  .delete-zone {
Â  Â  Â  background: #FEF2F2;
Â  Â  Â  border: 2px dashed #FCA5A5; /* Bordure plus visible */
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 20px;
Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  .delete-zone h4 {
Â  Â  Â  color: #B91C1C;
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  font-size: 1.1rem;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  .delete-actions {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  gap: 10px;
Â  Â  Â  flex-wrap: wrap; /* Pour la rÃ©activitÃ© */
Â  Â  }

Â  Â  .delete-actions button {
Â  Â  Â  background: var(--expense-color);
Â  Â  Â  font-size: 0.9rem;
Â  Â  Â  padding: 8px 15px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  color: #fff;
Â  Â  Â  border: none;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: background-color 0.2s ease, transform 0.1s ease;
Â  Â  }
Â  Â  .delete-actions button:hover {
Â  Â  Â  background: #DC2626;
Â  Â  Â  transform: translateY(-1px);
Â  Â  }

Â  Â  /* Graphique */
Â  Â  .chart-container {
Â  Â  Â  height: 250px; /* Un peu plus grand */
Â  Â  Â  margin-top: 20px;
Â  Â  }

Â  Â  /* Responsive Design */
Â  Â  @media (max-width: 900px) {
Â  Â  Â  .grid {
Â  Â  Â  Â  grid-template-columns: 1fr;
Â  Â  Â  }
Â  Â  }

Â  Â  @media (max-width: 600px) {
Â  Â  Â  body { padding: 15px; }
Â  Â  Â  h1 { font-size: 1.7rem; margin-bottom: 20px; }
Â  Â  Â  h2 { font-size: 1.2rem; }
Â  Â  Â  .summary { grid-template-columns: 1fr; }
Â  Â  Â  form { grid-template-columns: 1fr; }
Â  Â  Â  .card { padding: 20px; }
Â  Â  Â  .summary div span { font-size: 1.5rem; }
Â  Â  Â  .calendar-nav { flex-direction: column; gap: 10px; }
Â  Â  Â  .calendar-nav button { width: 100%; }
Â  Â  Â  .month-display { margin: 10px 0; }
Â  Â  Â  .transaction-list { max-height: 250px; }
Â  Â  }
Â  </style>
</head>
<body>

<div class="container">
Â  Â  <div class="card">
Â  Â  <h1>BudgetWise ğŸ“ˆ</h1>
Â  Â  <div class="summary">
Â  Â  Â  <div class="income-total">
Â  Â  Â  Â  <h3>Total Income</h3>
Â  Â  Â  Â  <span id="inc">$0.00</span>
Â  Â  Â  </div>
Â  Â  Â  <div class="expense-total">
Â  Â  Â  Â  <h3>Total Expenses</h3>
Â  Â  Â  Â  <span id="exp">$0.00</span>
Â  Â  Â  </div>
Â  Â  Â  <div class="balance-total">
Â  Â  Â  Â  <h3>Current Balance</h3>
Â  Â  Â  Â  <span id="sol">$0.00</span>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="grid">
Â  Â  <div class="card">
Â  Â  Â  <h2>Add a new transaction</h2>
Â  Â  Â  <form id="form" aria-label="Add new transaction form">
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="desc">Description</label>
Â  Â  Â  Â  Â  <input id="desc" type="text" placeholder="e.g., Groceries, Salary" required aria-required="true">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="mnt">Amount</label>
Â  Â  Â  Â  Â  <input id="mnt" type="number" step="0.01" placeholder="Amount (e.g., 50.00)" required aria-required="true">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="typ">Transaction Type</label>
Â  Â  Â  Â  Â  <select id="typ" required aria-required="true">
Â  Â  Â  Â  Â  Â  <option value="">Select Type</option>
Â  Â  Â  Â  Â  Â  <option value="income">Income</option>
Â  Â  Â  Â  Â  Â  <option value="expense">Expense</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="cur">Currency</label>
Â  Â  Â  Â  Â  <select id="cur" required aria-required="true">
Â  Â  Â  Â  Â  Â  <option value="">Select Currency</option>
Â  Â  Â  Â  Â  Â  <option value="EUR">EUR</option>
Â  Â  Â  Â  Â  Â  <option value="USD">USD</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="cat">Category</label>
Â  Â  Â  Â  Â  <select id="cat" required aria-required="true">
Â  Â  Â  Â  Â  Â  <option value="">Select Category</option>
Â  Â  Â  Â  Â  Â  <option value="salary">Salary</option>
Â  Â  Â  Â  Â  Â  <option value="food">Food</option>
Â  Â  Â  Â  Â  Â  <option value="housing">Housing</option>
Â  Â  Â  Â  Â  Â  <option value="transport">Transport</option>
Â  Â  Â  Â  Â  Â  <option value="utilities">Utilities</option>
Â  Â  Â  Â  Â  Â  <option value="entertainment">Entertainment</option>
Â  Â  Â  Â  Â  Â  <option value="other">Other</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="form-group">
Â  Â  Â  Â  Â  <label for="dat">Date</label>
Â  Â  Â  Â  Â  <input id="dat" type="date" required aria-required="true">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button type="submit" aria-label="Add transaction">Add Transaction</button>
Â  Â  Â  </form>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h2>Calendar View</h2>
Â  Â  Â  <div class="calendar-nav" role="navigation" aria-label="Calendar navigation">
Â  Â  Â  Â  <button id="prev" aria-label="Previous month">â€¹</button>
Â  Â  Â  Â  <div class="month-display" id="mois" aria-live="polite" aria-atomic="true"></div>
Â  Â  Â  Â  <button id="next" aria-label="Next month">â€º</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="calendar-header" role="row">
Â  Â  Â  Â  <div role="columnheader">Mon</div>
Â  Â  Â  Â  <div role="columnheader">Tue</div>
Â  Â  Â  Â  <div role="columnheader">Wed</div>
Â  Â  Â  Â  <div role="columnheader">Thu</div>
Â  Â  Â  Â  <div role="columnheader">Fri</div>
Â  Â  Â  Â  <div role="columnheader">Sat</div>
Â  Â  Â  Â  <div role="columnheader">Sun</div>
Â  Â  Â  </div>
Â  Â  Â  <div id="cal" class="calendar-grid" role="grid"></div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="grid">
Â  Â  <div class="card">
Â  Â  Â  <h2>Recent Transactions</h2>
Â  Â  Â  <div id="list" class="transaction-list"></div>
Â  Â  </div>
Â  Â  <div class="card">
Â  Â  Â  <h2>Expense Breakdown</h2>
Â  Â  Â  <div class="chart-container">
Â  Â  Â  Â  <canvas id="chart" role="img" aria-label="Doughnut chart showing expense categories"></canvas>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <div class="card delete-zone">
Â  Â  <h4>ğŸ—‘ï¸ Manage Data</h4>
Â  Â  <div class="delete-actions">
Â  Â  Â  <button id="delLast" aria-label="Delete last transaction">Delete Last</button>
Â  Â  Â  <button id="delMonth" aria-label="Delete all transactions for the current month">Delete Month</button>
Â  Â  Â  <button id="reset" aria-label="Reset all budget data">Reset All</button>
Â  Â  </div>
Â  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
// CoÃ»t fixe pour l'exemple, dans une vraie application, cela viendrait d'une API de taux de change
const EUR2USD = 1.08; 
let DATA = JSON.parse(localStorage.getItem('budgetEn')) || [];
let CUR_DATE = new Date();
let CHART; // Variable pour stocker l'instance du graphique Chart.js

/* ---------- UTILS ---------- */
const $ = id => document.getElementById(id);
const save = () => localStorage.setItem('budgetEn', JSON.stringify(DATA));
// Formatage de la monnaie pour un affichage propre
const fmt = n => n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

/* ---------- TOTALS ---------- */
// Met Ã  jour les totaux (revenus, dÃ©penses, solde)
function refreshTotals(){
Â  const inc = DATA.filter(t => t.type === 'income').reduce((s, t) => s + t.usd, 0);
Â  const exp = DATA.filter(t => t.type === 'expense').reduce((s, t) => s + t.usd, 0);
Â  $('inc').textContent = '$' + fmt(inc);
Â  $('exp').textContent = '$' + fmt(exp);
Â  $('sol').textContent = '$' + fmt(inc - exp);
}

/* ---------- CALENDAR ---------- */
// Construit et affiche le calendrier du mois courant
function buildCalendar(){
Â  const y = CUR_DATE.getFullYear(), m = CUR_DATE.getMonth();
Â  $('mois').textContent = new Date(y, m).toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
Â  
Â  const firstDayOfMonth = new Date(y, m, 1);
Â  const lastDayOfMonth = new Date(y, m + 1, 0);

Â  // Calcul du premier jour Ã  afficher (dÃ©but de la semaine du 1er du mois)
Â  const startDay = new Date(firstDayOfMonth);
Â  // Ajuste pour que la semaine commence le Lundi (0=Dim, 1=Lun...)
Â  startDay.setDate(startDay.getDate() - (startDay.getDay() === 0 ? 6 : startDay.getDay() - 1)); 

Â  $('cal').innerHTML = '';

Â  for (let i = 0; i < 42; i++) { // Affiche 6 semaines complÃ¨tes
Â  Â  const day = new Date(startDay);
Â  Â  day.setDate(startDay.getDate() + i);

Â  Â  const dayDiv = document.createElement('div');
Â  Â  dayDiv.className = 'calendar-day';
Â  Â  dayDiv.textContent = day.getDate();
Â  Â  dayDiv.setAttribute('role', 'gridcell');
Â  Â  dayDiv.setAttribute('aria-label', day.toDateString());

Â  Â  if (day.getMonth() !== m) {
Â  Â  Â  dayDiv.classList.add('other-month');
Â  Â  }
Â  Â  if (day.toDateString() === new Date().toDateString()) {
Â  Â  Â  dayDiv.classList.add('today');
Â  Â  }

Â  Â  // Ajoute des points pour les transactions
Â  Â  const dayTransactions = DATA.filter(t => new Date(t.date).toDateString() === day.toDateString());
Â  Â  if (dayTransactions.length) {
Â  Â  Â  const dotsContainer = document.createElement('div');
Â  Â  Â  dotsContainer.className = 'dots';
Â  Â  Â  if (dayTransactions.some(t => t.type === 'income')) {
Â  Â  Â  Â  const dot = document.createElement('div'); dot.className = 'dot income'; dotsContainer.appendChild(dot);
Â  Â  Â  }
Â  Â  Â  if (dayTransactions.some(t => t.type === 'expense')) {
Â  Â  Â  Â  const dot = document.createElement('div'); dot.className = 'dot expense'; dotsContainer.appendChild(dot);
Â  Â  Â  }
Â  Â  Â  dayDiv.appendChild(dotsContainer);
Â  Â  }

Â  Â  dayDiv.addEventListener('click', () => {
Â  Â  Â  $('dat').valueAsDate = day; // Remplit le champ date du formulaire
Â  Â  });
Â  Â  $('cal').appendChild(dayDiv);
Â  }
}

/* ---------- MONTH LIST ---------- */
// Affiche la liste des transactions pour le mois courant
function refreshList(){
Â  const y = CUR_DATE.getFullYear(), m = CUR_DATE.getMonth();
Â  const monthTransactions = DATA.filter(t => {
Â  Â  const d = new Date(t.date);
Â  Â  return d.getFullYear() === y && d.getMonth() === m;
Â  }).sort((a, b) => new Date(b.date) - new Date(a.date)); // Trie par date dÃ©croissante

Â  $('list').innerHTML = ''; // Vide la liste existante

Â  if (!monthTransactions.length) {
Â  Â  $('list').innerHTML = '<p style="text-align:center;color:var(--light-text-color); padding: 20px;">No transactions for this month.</p>';
Â  Â  return;
Â  }

Â  monthTransactions.forEach(t => {
Â  Â  const div = document.createElement('div');
Â  Â  div.className = 'list-item';
Â  Â  div.setAttribute('role', 'listitem');
Â  Â  div.innerHTML = `
Â  Â  Â  <div class="item-details">
Â  Â  Â  Â  <strong>${t.desc}</strong>
Â  Â  Â  Â  <small>${t.cat} â€¢ ${new Date(t.date).toLocaleDateString('en-US')}</small>
Â  Â  Â  </div>
Â  Â  Â  <div class="amount-info">
Â  Â  Â  Â  <div class="value ${t.type}">${t.amt} ${t.cur}</div>
Â  Â  Â  Â  <small>$${fmt(t.usd)}</small>
Â  Â  Â  </div>
Â  Â  Â  <button class="delete-btn" onclick="delTrans(${t.id})" aria-label="Delete transaction ${t.desc}">Ã—</button>
Â  Â  `;
Â  Â  $('list').appendChild(div);
Â  });
}

/* ---------- CHART ---------- */
// Met Ã  jour le graphique des dÃ©penses par catÃ©gorie
function refreshChart(){
Â  const ctx = $('chart').getContext('2d');
Â  if (CHART) CHART.destroy(); // DÃ©truit l'ancien graphique avant d'en crÃ©er un nouveau

Â  const expensesByCategory = DATA.filter(t => t.type === 'expense').reduce((acc, t) => {
Â  Â  acc[t.cat] = (acc[t.cat] || 0) + t.usd;
Â  Â  return acc;
Â  }, {});

Â  // Si aucune dÃ©pense, efface le canvas
Â  if (!Object.keys(expensesByCategory).length) {
Â  Â  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
Â  Â  return;
Â  }

Â  CHART = new Chart(ctx, {
Â  Â  type: 'doughnut',
Â  Â  data: {
Â  Â  Â  labels: Object.keys(expensesByCategory),
Â  Â  Â  datasets: [{
Â  Â  Â  Â  data: Object.values(expensesByCategory),
Â  Â  Â  Â  backgroundColor: ['#4F46E5', '#8B5CF6', '#EC4899', '#F59E0B', '#10B981', '#EF4444', '#0EA5E9', '#EAB308'], // Couleurs variÃ©es
Â  Â  Â  Â  hoverOffset: 8 // Effet au survol
Â  Â  Â  }]
Â  Â  },
Â  Â  options: {
Â  Â  Â  responsive: true,
Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  cutout: '70%', // Taille du trou central
Â  Â  Â  plugins: {
Â  Â  Â  Â  legend: {
Â  Â  Â  Â  Â  position: 'right', // LÃ©gende Ã  droite
Â  Â  Â  Â  Â  labels: {
Â  Â  Â  Â  Â  Â  font: {
Â  Â  Â  Â  Â  Â  Â  size: 12,
Â  Â  Â  Â  Â  Â  Â  family: 'Inter'
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  color: var('--text-color'),
Â  Â  Â  Â  Â  Â  usePointStyle: true, // Petits cercles pour la lÃ©gende
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  },
Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  label: function(context) {
Â  Â  Â  Â  Â  Â  Â  let label = context.label || '';
Â  Â  Â  Â  Â  Â  Â  if (label) {
Â  Â  Â  Â  Â  Â  Â  Â  label += ': ';
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  if (context.parsed !== null) {
Â  Â  Â  Â  Â  Â  Â  Â  label += '$' + fmt(context.parsed);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  return label;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  });
}

/* ---------- DELETE ACTIONS ---------- */
// Supprime une transaction spÃ©cifique par son ID
window.delTrans = id => {
Â  if (confirm('Are you sure you want to delete this transaction?')) {
Â  Â  DATA = DATA.filter(t => t.id !== id);
Â  Â  save();
Â  Â  refreshAll();
Â  }
};

// Supprime la derniÃ¨re transaction ajoutÃ©e
$('delLast').onclick = () => {
Â  if (!DATA.length) {
Â  Â  alert('There are no transactions to delete.');
Â  Â  return;
Â  }
Â  if (confirm('Delete the last transaction?')) {
Â  Â  DATA.pop(); // Retire le dernier Ã©lÃ©ment du tableau
Â  Â  save();
Â  Â  refreshAll();
Â  }
};

// Supprime toutes les transactions du mois courant
$('delMonth').onclick = () => {
Â  const y = CUR_DATE.getFullYear(), m = CUR_DATE.getMonth();
Â  const transactionsToDelete = DATA.filter(t => {
Â  Â  const d = new Date(t.date);
Â  Â  return d.getFullYear() === y && d.getMonth() === m;
Â  });

Â  if (!transactionsToDelete.length) {
Â  Â  alert('No transactions found for the current month.');
Â  Â  return;
Â  }
Â  if (confirm(`Delete ${transactionsToDelete.length} transaction(s) from this month?`)) {
Â  Â  // Filtre les donnÃ©es pour exclure les transactions du mois courant
Â  Â  DATA = DATA.filter(t => {
Â  Â  Â  const d = new Date(t.date);
Â  Â  Â  return !(d.getFullYear() === y && d.getMonth() === m);
Â  Â  });
Â  Â  save();
Â  Â  refreshAll();
Â  }
};

// RÃ©initialise toutes les donnÃ©es
$('reset').onclick = () => {
Â  if (confirm('Are you absolutely sure you want to delete ALL your budget data? This action cannot be undone.')) {
Â  Â  if (confirm('Seriously? All data will be lost.')) {
Â  Â  Â  DATA = [];
Â  Â  Â  save();
Â  Â  Â  refreshAll();
Â  Â  }
Â  }
};

/* ---------- FORM SUBMISSION ---------- */
$('form').addEventListener('submit', e => {
Â  e.preventDefault(); // EmpÃªche le rechargement de la page

Â  // Convertit le montant en USD si la devise est EUR
Â  const usdAmount = $('cur').value === 'USD' ? +$('mnt').value : +($('mnt').value * EUR2USD);

Â  // Ajoute la nouvelle transaction aux donnÃ©es
Â  DATA.push({
Â  Â  id: Date.now(), // ID unique basÃ© sur le timestamp
Â  Â  desc: $('desc').value,
Â  Â  amt: +$('mnt').value, // Montant original (ex: en EUR)
Â  Â  cur: $('cur').value, // Devise originale
Â  Â  type: $('typ').value, // Type de transaction (income/expense)
Â  Â  cat: $('cat').value, // CatÃ©gorie
Â  Â  date: $('dat').value, // Date de la transaction
Â  Â  usd: usdAmount // Montant converti en USD
Â  });
Â  
Â  save(); // Sauvegarde les donnÃ©es dans le localStorage
Â  refreshAll(); // Met Ã  jour l'interface
Â  e.target.reset(); // RÃ©initialise le formulaire
Â  $('dat').valueAsDate = new Date(); // RÃ©initialise la date au jour courant
});

/* ---------- CALENDAR NAVIGATION ---------- */
$('prev').onclick = () => {
Â  CUR_DATE.setMonth(CUR_DATE.getMonth() - 1); // Recule d'un mois
Â  refreshAll();
};
$('next').onclick = () => {
Â  CUR_DATE.setMonth(CUR_DATE.getMonth() + 1); // Avance d'un mois
Â  refreshAll();
};

/* ---------- INITIALISATION ---------- */
// Fonction principale pour rafraÃ®chir toutes les sections de l'UI
function refreshAll(){
Â  refreshTotals();
Â  buildCalendar();
Â  refreshList();
Â  refreshChart();
}

// Lance le rafraÃ®chissement initial au chargement de la page
refreshAll();
</script>
</body>
</html>
